<!doctype html>
<html lang="es">
<head>
	<meta charset="utf-8">
	<title>Iguana Fix</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no" />
	<meta name="description" content="Frontend Developer Challenge">

	<link type="text/css" rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/solid.css" integrity="sha384-HTDlLIcgXajNzMJv5hiW5s2fwegQng6Hi+fN6t5VAcwO/9qbg2YEANIyKBlqLsiT" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
	<link rel="stylesheet" href="css/main.css?id=0.1">

	<script type="text/javascript">
/*		// Create a request variable and assign a new XMLHttpRequest object to it.
		var request = new XMLHttpRequest();

		// Open a new connection, using the GET request on the URL endpoint
		request.open('GET', 'https://private-70cb45-aobara.apiary-mock.com/product/list',true);

request.onreadystatechange = function() {
  if (request.readyState === 4)  { 
    var serverResponse = request.responseText;
    alert(serverResponse)
  }
};*/

function myOnLoad(){

	// Cargar Producto
	var request = new XMLHttpRequest();
	request.open("GET","https://private-70cb45-aobara.apiary-mock.com/product/list",true);
	request.send();

	request.onload = function () {
			var data = JSON.parse(this.response);

		data.forEach((list,index) => {
			
			if(index==0){ 
				var selected = "selected"; 

				var price = "$"+convertPrice(list.unitPriceInCents);
				showPrice(price);
				var productId = list.id;
			}
				else { 
					selected = "";
				}

			document.getElementById("product-detail").innerHTML += "<option value='"+list.id+","+list.minQuantity+","+convertPrice(list.unitPriceInCents)+"'"+selected+">"+list.description+"</option>";
		});

	}
	setTimeout(function(){
		productImage();
	}, 1000); 
	

	// Cargar Listado
	var request = new XMLHttpRequest();
	request.open("GET","https://private-70cb45-aobara.apiary-mock.com/product/list",true);
	request.send();

	request.onload = function () {
			var data = JSON.parse(this.response);

		data.forEach(list => {
			document.getElementById("product-detail").innerHTML += "<option value='"+list.id+"'>"+list.description+"</option>";
		});

	}


	// Productos Relacionados
	request.open("GET","https://private-70cb45-aobara.apiary-mock.com/related-product/list",true);
	request.send();

	request.onload = function () {
			var data = JSON.parse(this.response);

		data.forEach((list,index) => {
			document.getElementById("related-products").innerHTML += "<div class='col-md-4'><div class='related-inner'><a href='#''><img src='"+list.pictureUrl+"'></a><div class='related-block'><h5>"+list.title+"</h5><p class='product-price'>desde $"+convertPrice(list.fromPrice)+"</p><p class='description'>"+list.description+"</p><button>Contratar</button></div></div></div>";

		});

	}

}


function productImage() {

	// Imágenes de productos
	var request = new XMLHttpRequest();
	var url = "https://private-70cb45-aobara.apiary-mock.com/product/"+obtainData(3)+"/photos";
	request.open("GET",url,true);
	request.send();

	request.onload = function () {
		var data = JSON.parse(this.response);
	
		data.forEach((list,index) => {
			if(index==0){ 
				document.getElementById("product-image").innerHTML = "<img src='"+list.url+"'>";				
			}
			document.getElementById("product-thumbs").innerHTML += "<a onclick='changeImage(\""+list.url+"\")'><img src='"+list.url+"'></a>";
		});

	}
}

function changeImage(url) {
	document.getElementById("product-image").innerHTML = "<img src='"+url+"'>";
}

function setSelectValue (id, val) {
    document.getElementById(id).value = val;
}

function convertPrice(price) {
	var new_price = price / 100; 
	return new_price;
}

function showPrice(price) {
	document.getElementById('product-price').innerHTML = "";

	var theDiv = document.getElementById("product-price");
	var content = document.createTextNode(price);
	theDiv.appendChild(content);
}

function reloadPrice(selectObject) {

	document.getElementById("product-thumbs").innerHTML = "";
	productImage(3);

	var quantity = document.getElementById('product-quantity').value;
	if(quantity <= 0 || quantity < obtainData(2)){
		quantity = obtainData(2);
	}

	showPrice("$"+calcPrice(obtainData(1),quantity));
	document.getElementById('product-quantity').value = quantity;
}

function reloadQuantityPrice(selectObject) {
	showPrice("$"+calcPrice(obtainData(1),selectObject.value));
	document.getElementById('product-quantity').value = selectObject.value;
}

function amount(operator) {
	var quantity = document.getElementById('product-quantity').value;

	if(operator == 1){
		quantity--;
		if(quantity <= 0 || quantity < obtainData(2)){
			quantity = obtainData(2);
		}
	}
	else {
		quantity++;
	}
	
	showPrice("$"+calcPrice(obtainData(1),quantity));
	document.getElementById('product-quantity').value = quantity;
}

function obtainData(selection) {
	var e = document.getElementById("product-detail");
	var info = e.options[e.selectedIndex].value;
	var array = info.split(",");

	if(selection == 1){
		// Quantity
		return array[2];
	}
	if(selection == 2){
		// Price
		return array[1];
	}
	if(selection == 3){
		// Product id
		return array[0];
	}
}

function calcPrice(price,quantity) {
	return price * quantity;
}



	</script>

</head>

<body onLoad="myOnLoad()">

	<header>
		<a href="index.html" class="logo-block">IguanaFix</a>

		<button class="menu-btn"><i class="fas fa-bars menu-bars"></i></button>
		<div class="header-data">
			<div class="telephone"><i class="fas fa-phone fa-xs fa-flip-horizontal"></i> 0810-220-6173</div>
			<nav>
				<ul>
					<li><a href="#">Casa</a></li>
					<li><a href="#">Auto</a></li>
					<li><a href="#">Empresas</a></li>
					<li><a href="#" class="login-button">Ingresar <i class="fas fa-user fa-sm"></i></a></li>
				</ul>		
			</nav>
		</div>

		<div id="login-Modal" role="dialog">
			<div class="login-block">
				<form>
				<label for="email">E-mail</label>
				<input type="email" name="email" autofocus="autofocus" autocomplete="current-email">
				<label for="pass">Contraseña</label>
				<input type="password" name="pass" autofocus="autofocus" autocomplete="current-password">

				<input type="submit" name="enviar">
				</form>
			</div>
		</div>
	</header>

	<main>
		<article class="container">
			<div class="row">
				<div class="col-md-12 product-tree">
					<p><a href="#">Contratar un servicio</a> <i class="fas fa-caret-right"></i> <a href="#">Instalación de aire acondicionado</a></p>
				</div>
			</div>
			<div class="row">
				<div class="block-images">
					<div class="col-md-1 product-thumbs" id="product-thumbs">
					</div>
					<div class="col-md-6 product-image" id="product-image">
					</div>
				</div>
				<div class="col-md-5 product-description">
					<h1>Instalación de aire acondicionado split</h1>
					<p class="product-price" id="product-price">						
					</p>

					<h3>Frigorías</h3>
					<form>
						<select name="product-detail" id="product-detail" onchange="reloadPrice(this)">
						</select>
						<div class="quantity-module">
							<button type="button" class="substract" onclick="amount(1)">-</button>
							<input type="number" name="product-quantity" min="1" value="1" id="product-quantity" onchange="reloadQuantityPrice(this)" onkeypress="reloadQuantityPrice(this); return event.keyCode != 13;">
							<button type="button" class="add" onclick="amount(2)">+</button>
							<label>unidades</label>	
						</div>
											
					</form>
					
					<div class="product-include">
						<button type="submit" class="btn-programar">Programar visita</button>

						<p>Qué incluye</p>
						<ul>
							<li><i class="fas fa-check"></i> Desinstalación del equipo anterior</li>
							<li><i class="fas fa-check"></i> Colocación de nuevo equipo: unidad anetrior y exterior</li>
							<li><i class="fas fa-check"></i> Colocación de drenaje</li>
						</ul>
					</div>					
				</div>
		</article>


		<article class="container product-more-details">

			<div class="row">
			<div id="tabs" class="col-md-12">
				<ul class="nav nav-tabs">
					<li class="active"><a data-toggle="tab" href="#tabs-1">Detalles del servicio</a></li>
					<li><a data-toggle="tab" href="#tabs-2">Qué no incluye</a></li>
				</ul>

				<div class="tab-content row">
					<div id="tabs-1" class="tab-pane fade in active col-md-8">
						<p>El servicio incluye la desinstalación del aire acondicionado split anterior en caso de que lo hubiera. Colocación del nuevo equipo: unidad interior (hasta 2,5 mts de altura, incluído el taparroyos) y exterior (en lugares accesibles, hasta 2,5 mts de altura), Colocación de drenaje. Presurización, vacío y control de carga. Ménsulas estándar. Cañería de interconexión hasta 3 mts (3 mts de caño de cobre 1/2 o 1/4, 3 mts de cable tipo taller - 5 1/2, 3 mts de manguera de desagüe para drenaje, cinta PVC, Kit de tornillos y/o caños equivalentes según el equipo). Prueba del equipo. Limpieza del lugar.</p>
						<p>Si no lo hubiera incluye perforación en pared pero no se incluyen trabajos de albañilería ni pintura para su cobertura.</p>
						<p>Para el caso de los servicios que se realicen utilizando cajas de pre-instalaciones ya existentes en el domicilio o en cañerías embutidas, no se podrá garantizar el estado de tales materiales dado que no son provistos por el profesional.</p>
					</div>

					<div id="tabs-2" class="tab-pane fade col-md-8">
						<p>NO INCLUYE</p>
						<p>El servicio incluye la desinstalación del aire acondicionado split anterior en caso de que lo hubiera. Colocación del nuevo equipo: unidad interior (hasta 2,5 mts de altura, incluído el taparroyos) y exterior (en lugares accesibles, hasta 2,5 mts de altura), Colocación de drenaje. Presurización, vacío y control de carga. Ménsulas estándar. Cañería de interconexión hasta 3 mts (3 mts de caño de cobre 1/2 o 1/4, 3 mts de cable tipo taller - 5 1/2, 3 mts de manguera de desagüe para drenaje, cinta PVC, Kit de tornillos y/o caños equivalentes según el equipo). Prueba del equipo. Limpieza del lugar.</p>
						<p>Si no lo hubiera incluye perforación en pared pero no se incluyen trabajos de albañilería ni pintura para su cobertura.</p>
						<p>Para el caso de los servicios que se realicen utilizando cajas de pre-instalaciones ya existentes en el domicilio o en cañerías embutidas, no se podrá garantizar el estado de tales materiales dado que no son provistos por el profesional.</p>
					</div>
				</div>

				<div class="related-products row">
					<div class="col-md-8" id="related-products"></div>
				</div>

			</div>
			</div>

		</article>

		</div>
	</main>


	<footer>
		<div class="container">
		<div class="row">
			<div class="col-md-12 header-footer">
				<a href="index.html" class="logo-block">IguanaFix</a>
				<ul>
					<li><a href="https://www.facebook.com/IguanaFix" target="_blank"><i class="fab fa-facebook-f fa-lg"></i></a></li>
					<li><a href="https://www.instagram.com/iguanafix/" target="_blank"><i class="fab fa-instagram fa-lg"></i></a></li>
					<li><a href="https://plus.google.com/+IguanafixAr" target="_blank"><i class="fab fa-google-plus-g fa-lg"></i></a></li>
					<li><a href="https://www.youtube.com/user/iguanafixcom" target="_blank"><i class="fab fa-youtube fa-lg"></i></a></li>
					<li><a href="https://twitter.com/IguanaFix" target="_blank"><i class="fab fa-twitter fa-lg"></i></a></li>
					<li><a href="mailto:contacto@iguanafix.com.ar"><i class="fas fa-envelope-square fa-lg"></i></a></li>
				</ul>
			</div>

			<div class="col-md-12">
				<h4>Casa</h4>
				<hr>
				<ul class="category-links">
					<li class="col-md-3 first-link"><a href="#">Climatización</a></li>
					<li class="col-md-3"><a href="#">Pintura</a></li>
					<li class="col-md-3"><a href="#">Plomería</a></li>
					<li class="col-md-3"><a href="#">Electricidad</a></li>
					<li class="col-md-3"><a href="#">Pequeños Trabajos de Electricidad</a></li>
					<li class="col-md-3"><a href="#">Gas</a></li>
					<li class="col-md-3"><a href="#">Mudanzas</a></li>
					<li class="col-md-3"><a href="#">Electrodomésticos</a></li>
					<li class="col-md-3"><a href="#">Artefactos de Baño</a></li>
					<li class="col-md-3"><a href="#">Cocinas - Hornos - Anafes - Campanas</a></li>
					<li class="col-md-3"><a href="#">Remodelaciones y Refacciones</a></li>
					<li class="col-md-3"><a href="#">Pisos</a></li>
					<li class="col-md-3"><a href="#">Visitas de Diagnóstico</a></li>
				</ul>
			</div>

			<div class="col-md-12 second-category-links">
				<h4>Autos</h4>
				<hr>
				<ul class="category-links">
					<li class="col-md-3 first-link"><a href="#">Chapa y Pintura</a></li>
					<li class="col-md-3"><a href="#">Equipos de GNC</a></li>
					<li class="col-md-3"><a href="#">Mecánica Integral</a></li>
					<li class="col-md-3"><a href="#">Neumáticos</a></li>
					<li class="col-md-3"><a href="#">Polarizado</a></li>
					<li class="col-md-3"><a href="#">Otros Servicios</a></li>
				</ul>
			</div>
		</div>
		</div>

		<div class="container-fluid footer-copyright">
			<div class="container">
				<div class="row">
					<div class="col-md-7"><p>Copyright © 2018. All rights reserved | <strong>IguanaFix</strong></p></div>
					<div class="col-md-5 footer-badges">
						<div class="badges-block">
							<img src="image/badge-google-play_es.svg">
							<img src="image/badge-app-store_es.svg">						
							<img src="image/DATAWEB.jpg">
						</div>
					</div>
				</div>
			</div>
		</div>
				


	</footer>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<script type="text/javascript" src="script/script.js?v=0.1"></script>

</body>
</html>